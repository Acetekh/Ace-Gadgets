<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Interactive Europe Map — Demo</title>

  <!-- D3 + topojson (via CDN) -->
  <script src="https://unpkg.com/d3@7/dist/d3.min.js"></script>

  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --bg: black;
      --card: black;
      --muted: #7a7a80;
      --accent: #8b2cff;
      --highlight: #8b2cff;
      --stroke: rgba(0,0,0,0.06);
    }

    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: var(--bg);
      color: #111;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      padding: 36px;
    }

    .page {
      max-width: 1200px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 1fr 520px;
      gap: 36px;
      align-items: start;
    }

    .info {
      padding: 22px;
    }

    h1 { margin:0 0 8px; font-size: 32px; letter-spacing: -0.02em; }
    p.lead { color: var(--muted); margin:0 0 18px; }

    .map-card {
      background: white;
      border-radius: 14px;
      padding: 18px;
      box-shadow: 0 10px 30px rgba(11,10,12,0.06);
      border: 1px solid var(--stroke);
    }

    /* SVG container */
    #map {
      width: 100%;
      height: 520px;
      display: block;
      border-radius: 10px;
      overflow: hidden;
      background: whitesmoke;
    }

    /* Country style */
    .country {
      fill: #fff;
      stroke: rgba(0,0,0,0.06);
      stroke-width: 0.8px;
      transition: fill 180ms ease, transform 200ms;
    }
    .country:hover {
      fill: var(--highlight);
      cursor: pointer;
      transform: translateY(-3px);
    }
    .country.active {
      fill: var(--accent);
    }

    /* small tooltip */
    .tooltip {
      position: absolute;
      pointer-events: none;
      padding: 7px 10px;
      background: rgba(0,0,0,0.8);
      color: #fff;
      border-radius: 6px;
      font-size: 13px;
      transform: translate(-50%, -120%);
      white-space: nowrap;
      box-shadow: 0 6px 18px rgba(0,0,0,0.25);
      z-index: 40;
      display: none;
    }

    /* country label box like the screenshot */
    .label {
      position: absolute;
      background: #fff;
      color: #111;
      padding: 6px 10px;
      border-radius: 6px;
      border: 1px solid rgba(0,0,0,0.06);
      box-shadow: 0 8px 20px rgba(0,0,0,0.08);
      font-weight: 600;
      font-size: 13px;
      display: none;
      z-index: 30;
    }

    /* small legend */
    .legend { margin-top: 10px; color: var(--muted); font-size: 13px; }
    .hint { margin-top: 14px; color: var(--muted); font-size: 13px; }

    @media (max-width:980px){
      .page { grid-template-columns: 1fr; }
      #map { height: 420px; }
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="info">
      <h1>Our Branches</h1>
      <p class="lead">Thirteen branches, one contact — hover countries on the map to view a quick label. This demo uses GeoJSON rendered into SVG with D3.</p>

      <div class="legend">Hover/click a country → highlight + label</div>
      <div class="hint">Data source: public countries GeoJSON (client-side)</div>
    </div>

    <div class="map-card" style="position:relative;">
      <!-- Tooltip / label elements -->
      <div id="tooltip" class="tooltip"></div>
      <div id="label" class="label"></div>

      <!-- svg map will be injected here -->
      <svg id="map" viewBox="0 0 900 700" preserveAspectRatio="xMidYMid meet"></svg>
    </div>
  </div>

  <script>
  (async function(){
    // width/height for internal projection
    const width = 900;
    const height = 700;

    const svg = d3.select('#map')
      .attr('viewBox', `0 0 ${width} ${height}`);

    const tooltip = d3.select('#tooltip');
    const label = d3.select('#label');

    // Projection centered over Europe
    const projection = d3.geoMercator()
      .center([15, 54]) // center (lon, lat) around Europe
      .scale(700)
      .translate([width/2, height/2 + 30]);

    const path = d3.geoPath().projection(projection);

    // Load countries GeoJSON (public dataset)
    // This URL is a raw dataset of countries with properties including ADMIN (name).
    const geoUrl = 'https://raw.githubusercontent.com/datasets/geo-countries/master/data/countries.geojson';

    try {
      const geo = await fetch(geoUrl).then(r => r.json());

      // Filter features to approximate Europe using centroid bounds (lon between -11 and 45, lat between 34 and 72)
      const europeFeatures = geo.features.filter(f => {
        const c = d3.geoCentroid(f);
        const lon = c[0], lat = c[1];
        return lon >= -11 && lon <= 45 && lat >= 34 && lat <= 72;
      });

      // Add a group for countries
      const g = svg.append('g').attr('class','countries');

      g.selectAll('path')
        .data(europeFeatures)
        .enter()
        .append('path')
        .attr('class','country')
        .attr('d', path)
        .attr('data-name', d => d.properties.ADMIN || 'Unknown')
        .on('mousemove', (event, d) => {
          const [mx, my] = d3.pointer(event, document.body);
          const name = d.properties.ADMIN || 'Unknown';

          // position tooltip near mouse
          tooltip.style('left', (mx + 12) + 'px')
                 .style('top', (my - 12) + 'px')
                 .style('display', 'block')
                 .html(`<strong>${name}</strong>`);

          // show a nicer fixed label near centroid for clicked/highlighted states (not on every hover)
        })
        .on('mouseout', () => {
          tooltip.style('display','none');
        })
        .on('click', (event, d) => {
          // Clear previous active
          svg.selectAll('.country').classed('active', false);

          // Set active on clicked country
          d3.select(event.currentTarget).classed('active', true);

          // compute centroid screen coords to place "label box"
          const c = path.centroid(d); // [x,y] in svg coordinates
          if (!isNaN(c[0]) && !isNaN(c[1])) {
            // convert svg coords to page coords for absolute label placement
            const pt = svg.node().createSVGPoint();
            pt.x = c[0];
            pt.y = c[1];
            const screenCTM = svg.node().getScreenCTM();
            const globalPt = pt.matrixTransform(screenCTM);

            label.style('left', (globalPt.x + 20) + 'px')
                 .style('top', (globalPt.y - 10) + 'px')
                 .style('display', 'block')
                 .text(d.properties.ADMIN || 'Unknown');
          }
        });

      // optional: draw country borders with slightly darker stroke (already handled by CSS)
      // Add zoom + pan (optional)
      svg.call(d3.zoom().scaleExtent([1, 5]).on('zoom', (event) => {
        g.attr('transform', event.transform);
      }));

    } catch (err) {
      console.error('Failed to load geojson', err);
      svg.append('text').attr('x',20).attr('y',40).text('Failed to load map data.');
    }

    // hide label on outside click
    document.addEventListener('click', (ev) => {
      const isMap = ev.target.closest('#map');
      if (!isMap) label.style('display','none');
    });

  })();
  </script>
</body>
</html>
